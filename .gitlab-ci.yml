variables:
  LUA: "lua-5.3.3"
  SRC: "lua-5.3.3/src"

build:
  stage: build
  before_script:
  - curl -R -O http://www.lua.org/ftp/$LUA.tar.gz
  - tar zxf $LUA.tar.gz
  - cd $LUA
  - make linux test
  - cd ..
  script:
  - make all LC="$SRC/luac" CFLAGS="-I$SRC" LDFLAGS="-L$SRC"
  artifacts:
    paths:
    - palantir

test:
  stage: test
  script:
  - ./palantir -v

deploy:
  stage: deploy
  script:
  - cp palantir ~/bin/
  environment: uberspace
